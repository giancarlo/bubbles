(function(t,i){"use strict";var e,n=t.document,s=function(i){t.addEventListener("load",function(){new s.Engine(i)})},r=s.factory=function(t){return function(i){return new t(i)}},h=s.extend=function(t,i){for(var e in i)t[e]=i[e]};s.Class=function(t){this.extend(t)},h(s,{id:function(t){return n.getElementById(t)},ready:function(i){t.addEventListener("load",i,!1)},rand:function(t){return Math.random()*t},irand:function(t){return 0|Math.random()*t},ary:function(t,i,e){var n,s=[];if(i)for(;i--;)for(s[i]=[],n=0;t>n;n++)s[i][n]=e;else for(;t--;)s.push(e);return s},dom:function(t){return n.createElement(t)},canvas:function(t,i){var e=s.dom("CANVAS");return e.setAttribute("width",t),e.setAttribute("height",i),e},get_type:function(i){var e=typeof i;if("object"===e){if(null===i)return"null";if(i instanceof Array)return"array";if(i instanceof s.Class)return"j5g3";if(i instanceof t.HTMLElement)return"dom";if(i instanceof t.Image)return"dom";if(i instanceof t.HTMLAudioElement)return"audio"}return e},gradient:function(t,i,n,s){return e.getContext("2d").createLinearGradient(t,i,n,s)},rgba:function(t,e,n,s){return s===i&&(s=1),"rgba("+t+","+e+","+n+","+s+")"},hsla:function(t,e,n,s){return s===i&&(s=1),"hsla("+t+","+e+"%,"+n+"%,"+s+")"}}),s.dom.src=function(t,i){var e=n.createElement(t);return e.setAttribute("src",i),e},s.dom.image=function(t){return s.dom.src("img",t)},s.Class.extend=function(t,i){var e,n,r=this,h=t.init||function(){r.apply(this,arguments)},a=function(){};a.prototype=r.prototype,h.prototype=new a,h.extend=s.Class.extend;for(e in t)t.hasOwnProperty(e)&&(n=Object.getOwnPropertyDescriptor(t,e),Object.defineProperty(h.prototype,e,n));for(e in i)i.hasOwnProperty(e)&&(n=Object.getOwnPropertyDescriptor(i,e),Object.defineProperty(h,e,n));return h},s.Class.prototype.extend=function(t){for(var i in t)this[i]=t[i]},s.Draw={Void:function(){},Default:function(t){this.begin(t),this.paint(t),this.end(t)},NoTransform:function(t){this.paint(t)},Root:function(){var t=this.context;t.clearRect(0,0,this.canvas.width,this.canvas.height),this.begin(t),this.paint(t),this.end(t),this.screen.clearRect(0,0,this.canvas.width,this.canvas.height),this.screen.drawImage(this.renderCanvas,0,0)},RootDirty:function(){var t=this,i=this.context,e=t._dx,n=t._dw,s=t._dy,r=t._dh;0!==n&&0!==r&&(i.clearRect(e,s,n,r),t.begin(i),t.paint(i),t.end(i),t.screen.clearRect(e,s,n,r),t.screen.drawImage(t.renderCanvas,e,s,n,r,e,s,n,r),t._dx=t.width,t._dy=t.height,t._dh=t._dw=0)},RootDirect:function(){var t=this.context;this.clearRect(0,0,this.canvas.width,this.canvas.height),this.begin(t),this.paint(t),this.end(t)},FastImage:function(t){t.drawImage(this.source,this.x+this.cx,this.y+this.cy)},Cache:function(t){t.drawImage(this._cache_source,0,0,this.width,this.height,this.x+this.cx,this.y+this.cy,this.width,this.height)}},s.Paint={Image:function(t){t.drawImage(this.source,this.cx,this.cy)},Sprite:function(t){var i=this.source;t.drawImage(i.image,i.x,i.y,i.w,i.h,this.cx,this.cy,this.width,this.height)},Container:function(t){var i=this.frame,e=i;for(t.translate(this.cx,this.cy);(e=e._next)!==i;)e.draw(t)},Text:function(t){t.fillText(this.text,this.cx,this.cy)},MultilineText:function(t){for(var i=this.text.split("\n"),e=0,n=i.length,s=0;n>e;e++)t.fillText(i[e],this.cx,this.cy+s),s+=this.line_height},TextStroke:function(t){t.strokeText(this.text,this.cx,this.cy)},TextStrokeFill:function(t){t.fillText(this.text,this.cx,this.cy),t.strokeText(this.text,this.cx,this.cy)},Map:function(t){var i,e,n,s=this.map,r=s.length,h=this.sprites;for(t.translate(this.cx,this.cy+r*this.th);r--;)for(i=s[r].length,n=s[r],t.translate(i*this.tw,-this.th);i--;)t.translate(-this.tw,0),(e=h[n[i]])&&e.draw(t)},Isometric:function(t){var i,e,n,s,r=this.map,h=0,a=r.length,o=this.sprites,c=(0|this.tw/2)+this.offsetX,u=(0|this.th/2)+this.offsetY;for(t.translate(this.cx,this.cy-u),n=c;a>h;h++)for(i=r[h].length,e=r[h],n=-n,t.translate(i*this.tw-n,u);i--;)t.translate(-this.tw,0),(s=o[e[i]])&&s.draw(t)}},s.Cache={Canvas:function(t,i){var e,n=this,r=s.dom("CANVAS");return t=t||n.width,i=i||n.height,r.width=t,r.height=i,e=r.getContext("2d",!1),e.translate(-n.x-n.cx,-n.y-n.cy),n.clear_cache(),n.draw(e),n._cache_source=r,n._oldPaint=n.draw,n.draw=s.Draw.Cache,this},use:function(t,i,n){var s;return s=i(n,e.getContext("2d"))}},s.HitTest={Void:function(){return!1},Circle:function(t,i,e){return e=e?e.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y),e.to_client(t,i),e.x*e.x+e.y*e.y<=this.radius*this.radius?this:!1},Container:function(t,i,e){var n,s=this.frame,r=s;for(e=e?e.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y);(r=r._previous)!==s&&!(n=r.at(t,i,e)););return n},Rect:function(t,i,e){return e=e?e.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y),e.to_client(t,i),e.x>0&&e.x<this.width&&e.y>0&&e.y<this.height?this:!1},Polygon:function(t,i,e){var n,s=this.points,r=this.normals,h=0,a=s.length;for(e=e?e.product(this.M,this.x,this.y):this.M.to_m(this.x,this.y),e.to_client(t,i);a>h;h+=2)if(n=r[h]*(e.x-s[h])+r[h+1]*(e.y-s[h+1]),n>0)return!1;return this}},s.MatrixLite=s.Class.extend({a:1,b:0,c:0,d:1,_cos:1,_sin:0,scaleX:1,scaleY:1,init:function(t,e,n,s){t!==i&&(this.a=t,this.b=e,this.c=n,this.d=s)},setRotation:function(t){return this._cos=Math.cos(t),this._sin=Math.sin(t),this.calc4()},setScaleX:function(t){return this.scaleX=t,this.calc4()},setScaleY:function(t){return this.scaleY=t,this.calc4()},scale:function(t,i){return this.scaleX=t,this.scaleY=i,this.calc4()},calc4:function(){return this.a=this.scaleX*this._cos,this.b=this.scaleX*this._sin,this.c=-this.scaleY*this._sin,this.d=this.scaleY*this._cos,this},to_m:function(t,i){return new s.Matrix(this.a,this.b,this.c,this.d,t||0,i||0)}}),s.Matrix=s.Class.extend({a:1,b:0,c:0,d:1,e:0,f:0,init:function(t,e,n,s,r,h){t!==i&&(this.a=t,this.b=e,this.c=n,this.d=s,this.e=r,this.f=h)},multiply:function(t,i,e,n,s,r){var h=this.a,a=this.b,o=this.c,c=this.d;return this.a=h*t+o*i,this.b=a*t+c*i,this.c=h*e+o*n,this.d=a*e+c*n,this.e+=h*s+o*r,this.f+=a*s+c*r,this},clone:function(){return s.matrix().multiply(this.a,this.b,this.c,this.d,this.e,this.f)},inverse:function(){var t=this.clone(),i=this.a*this.d-this.b*this.c;return t.a=this.d/i,t.b=this.b/-i,t.c=this.c/-i,t.d=this.a/i,t.e=(this.d*this.e-this.c*this.f)/-i,t.f=(this.b*this.e-this.a*this.f)/i,t},product:function(t,i,e){return this.clone().multiply(t.a,t.b,t.c,t.d,t.e||i||0,t.f||e||0)},reset:function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},to_world:function(t,i){return this.x=this.a*t+this.c*i+this.e,this.y=this.b*t+this.d*i+this.f,this},to_client:function(t,i){var e=this.a*this.d-this.b*this.c;return this.x=(this.d*t-this.c*i+this.c*this.f-this.d*this.e)/e,this.y=(-this.b*t+this.a*i+this.b*this.e-this.a*this.f)/e,this}}),s.DisplayObject=s.Class.extend({source:null,_next:null,_previous:null,parent:null,M:null,x:0,y:0,cx:0,cy:0,width:null,height:null,_rotation:0,set rotation(t){this.M.setRotation(this._rotation=t)},get rotation(){return this._rotation},set sx(t){this.width*=t,this.M.setScaleX(t)},get sx(){return this.M.scaleX},set sy(t){this.height*=t,this.M.setScaleY(t)},get sy(){return this.M.scaleY},alpha:1,blending:null,stroke:null,fill:null,font:null,line_width:null,line_cap:null,line_join:null,miter_limit:null,dirty:!0,init:function(t){this.M=new s.MatrixLite,this.extend(t)},begin:function(t){var i=this,e=this.M;t.save(),1!==i.alpha&&(t.globalAlpha*=i.alpha),null!==i.fill&&(t.fillStyle=i.fill),null!==i.stroke&&(t.strokeStyle=i.stroke),null!==i.font&&(t.font=i.font),null!==i.blending&&(t.globalCompositeOperation=i.blending),null!==i.line_width&&(t.lineWidth=i.line_width),null!==i.line_cap&&(t.lineCap=i.line_cap),null!==i.line_join&&(t.lineJoin=i.line_join),null!==i.miter_limit&&(t.miterLimit=i.miter_limit),t.transform(e.a,e.b,e.c,e.d,i.x,i.y)},end:function(t){t.restore()},draw:s.Draw.Default,_paint:null,invalidate:function(){this.parent.invalidate(this)},update:null,remove:function(){return this.parent&&(this._previous._next=this._next,this._next._previous=this._previous,this.parent=this._previous=null),this},align:function(t,i){switch(i=i||this.parent,t){case"center":this.x=i.width/2;break;case"left":this.x=0;break;case"right":this.x=i.width-this.width;break;case"middle":this.y=i.height/2;break;case"center middle":this.pos(i.width/2,i.height/2);break;case"origin":this.pos(-this.width/2,-this.height/2);break;case"origin top":this.pos(-this.width/2,-this.height);break;case"origin bottom":this.pos(-this.width/2,0)}return this},pos:function(t,i){return this.x=t,this.y=i,this},size:function(t,i){return this.width=t,this.height=i,this},move:function(t,i){return this.x+=t,this.y+=i,this},visible:function(){return this.alpha>0},stretch:function(t,i){return this.scale(t/this.width,i/this.height)},to_clip:function(){return s.clip({width:this.width,height:this.height}).add(this)},cache:s.Cache.Canvas,clear_cache:function(){this._oldPaint&&(this.draw=this._oldPaint)},set:function(t){return this.extend(t),this},at:s.HitTest.Rect,scale:function(t,i){return this.sx=t,this.sy=i,this},rotate:function(t){return this.rotation+=t,this}}),s.Image=s.DisplayObject.extend({init:function(t){switch(s.get_type(t)){case"string":t={source:s.id(t)};break;case"dom":t={source:t}}s.DisplayObject.apply(this,[t]),this.source&&this.set_source(this.source)},paint:s.Paint.Image,_get_source:function(t){return"string"==typeof t?s.id(t):t},set_source:function(t){this.source=this._get_source(t),null===this.width&&(this.width=this.source.width),null===this.height&&(this.height=this.source.height)}}),s.Text=s.DisplayObject.extend({text:"",line_height:12,init:function(t){"string"==typeof t&&(t={text:t}),s.DisplayObject.apply(this,[t])},paint:s.Paint.Text,_get_width:function(t,i){t.begin(i);var e=i.measureText(t.text);return t.end(),e.width},get_width:function(){return s.Cache.use(this._get_width,this)}}),s.Html=s.DisplayObject.extend({html:"",init:function(t){"string"==typeof t&&(t={html:s.dom(t).innerHTML}),s.DisplayObject.apply(this,[t])}}),s.Clip=s.DisplayObject.extend({_frames:null,_frame:0,_playing:!0,init:function(t){s.DisplayObject.apply(this,[t]),this._frames=[],this.add_frame(),null!==this.setup&&this.setup()},invalidate:function(t){this.parent.invalidate(t)},setup:null,update:function(){var t=this.frame,i=t;for(this.update_frame&&this.update_frame();(i=i._next)!==t;)null!==i.update&&i.update();this._playing&&(this._frame=this._frame===this._frames.length-1?0:this._frame+1,this.frame=this._frames[this._frame])},frame:null,paint:s.Paint.Container,stop:function(){return this._playing=!1,this},play:function(){return this._playing=!0,this},is_playing:function(){return this._playing},add:function(t){switch(s.get_type(t)){case"function":t=new s.Action(t);break;case"string":t=new s.Image({source:t});break;case"array":for(var i=0;t.length>i;i++)this.add(t[i]);return this;case"audio":break;case"dom":case"object":t=new s.Image(t);break;case"undefined":case"null":throw"Trying to add undefined object to clip."}return this.add_object(t)},add_object:function(t){var i=this.frame;return t.parent&&t.remove(),i._previous._next=t,t._previous=i._previous,t._next=i,t.parent=this,i._previous=t,this},add_frame:function(t){var i={};return i._previous=i._next=i,this._frames.push(i),this.go(this._frames.length-1),t?this.add(t):this},is_frame_empty:function(){return this.frame._next===this.frame},remove_frame:function(t){return t=t===i?this._frame:t,this._frames.splice(t,1),this.go(t-1),this},go:function(t){return this.frame=this._frames[this._frame=t],this},each:function(t){for(var i,e,n=this._frames.length;n--;)for(e=i=this._frames[n];(e=e._next)!==i;)t(e);return this},align_children:function(t){return this.each(function(i){i.align&&i.align(t)})},at:s.HitTest.Container}),s.Stage=s.Clip.extend({canvas:null,context:null,screen:null,renderCanvas:null,smoothing:!1,_dx:0,_dy:0,_dw:0,_dh:0,_init_canvas:function(){this.canvas||(this.canvas=s.dom("CANVAS"),this.canvas.width=this.width,this.canvas.height=this.height,t.document.body.appendChild(this.canvas))},init:function(t){var i=this;s.Clip.apply(i,[t]),i._init_canvas(),i.renderCanvas=s.dom("CANVAS"),i.context=i.renderCanvas.getContext("2d"),i.screen=i.canvas.getContext("2d"),i.resolution(i.width||i.canvas.clientWidth||640,i.height||i.canvas.clientHeight||480),i._dw=i.width,i._dh=i.height,i.screen.imageSmoothingEnabled=i.context.imageSmoothingEnabled=i.screen.webkitImageSmoothingEnabled=i.context.webkitImageSmoothingEnabled=i.smoothing},invalidate:function(t){if(t===i)return this._dx=this._dy=0,this._dh=this.height,this._dw=this.width,i;var e=t.x+t.cx,n=t.y+t.cy;this._dx>e&&(this._dx=e),this._dy>n&&(this._dy=n),t.width>this._dw&&(this._dw=t.width,this._dx+this._dw>this.width&&(this._dw=this.width-this._dx)),t.height>this._dh&&(this._dh=t.height,this._dy+this._dh>this.height&&(this._dh=this.height-this._dy))},resolution:function(t,i){if(0===t||0===i)throw Error("Invalid stage resolution: "+t+"x"+i);return this.canvas.width=this.renderCanvas.width=t,this.canvas.height=this.renderCanvas.height=i,this.size(t,i)},draw:s.Draw.Root}),s.Tween=s.DisplayObject.extend({auto_remove:!1,repeat:1/0,duration:100,is_playing:!1,from:null,target:null,to:null,t:0,on_stop:null,on_remove:null,init:function(t){t instanceof s.Class&&(t={target:t}),this.update=this.start,this.extend(t)},draw:s.Draw.Void,pause:function(){return this._olddraw=this.update,this.update=null,this},resume:function(){return this.update=this._olddraw?this._olddraw:this.start,this},rewind:function(){return this.repeat-=1,this.t=0,this.vf=0,this},restart:function(){return this.t=0,this.stop().start()},stop:function(){return this.pause().rewind(),this.on_stop&&this.on_stop(),this},easing:function(t){return t},apply_tween:function(t,i){return this.from[t]+this.easing(i)*(this.to[t]-this.from[t])},_remove:s.DisplayObject.prototype.remove,remove:function(){this.on_remove&&this.on_remove(),this._remove()},_calculate:function(){var t,i=this,e=i.target;i.duration===i.t&&(i.vf=1);for(t in i.to)e[t]=i.apply_tween(t,i.vf);i.t<i.duration?(i.t++,i.vf+=i.v):i.auto_remove?i.remove():i.repeat?i.rewind():i.stop()},start:function(){var t,i=this,e=i.to,n=i.target;if(null===i.from){i.from={};for(t in e)i.from[t]=n[t]}return i.v=1/i.duration,i.vf=0,i.update=i._calculate,this},at:s.HitTest.Void},{Shake:function(t,i,e){i=i||3;var n=2*i;return new s.Tween({duration:e||10,target:t,auto_remove:!0,to:{x:0,y:0},apply_tween:function(t,e){return 1===e?this.to[t]:-i+s.rand(n)}})}}),s.Sprite=s.DisplayObject.extend({init:function(t){if(s.DisplayObject.apply(this,[t]),!this.source)throw Error("Invalid source property for Sprite");null===this.width&&(this.width=this.source.w),null===this.height&&(this.height=this.source.h)},paint:s.Paint.Sprite}),s.Spritesheet=s.Class.extend({width:0,height:0,source:null,_sprites:null,init:function(t){switch(s.get_type(t)){case"string":case"dom":case"j5g3":t={source:t};break;case"undefined":t={}}switch(s.get_type(t.source)){case"string":case"dom":t.source=new s.Image(t.source)}if(!t.source)throw Error("Invalid source for Spritesheet.");t.width===i&&t.source&&(t.width=t.source.width),t.height===i&&t.source&&(t.height=t.source.height),this.extend(t),this._sprites=[]},select:function(t){var i=[];return this.each(t,function(t){i.push(t)}),i},each:function(t,i){for(var e=0,n=t.length;n>e;e++)i(this.sprite(t[e]));return this},clip:function(t){var i=s.clip().remove_frame(),e=0,n=0;return this.each(t,function(t){i.add_frame(t),t.width>e&&(e=t.width),t.height>n&&(n=t.height)}),i.size(e,n)},push:function(t,i,e,n){return this.slice(t,i,e,n),this},slice:function(t,i,e,n){return this._sprites.push({width:e,height:n,source:{image:this.source.source,x:t,y:i,w:e,h:n}})-1},cut:function(t,i,e,n){return this.sprite(this.slice(t,i,e,n))},grid:function(t,i,e){e=e||0;var n,s,r=2*e,h=0|this.width/t-r,a=0|this.height/i-r;for(n=0;i>n;n++)for(s=0;t>s;s++)this.slice(s*(h+r)+e,n*(a+r)+e,h,a);return this},sprite:function(t){return new s.Sprite(this._sprites[t])},sprites:function(){for(var t=0,i=this._sprites.length,e=[];i>t;t++)e.push(this.sprite(t));return e},map:function(t,i){return new s.Map({sprites:this.sprites(),tw:t,th:i})}}),s.Emitter=s.Clip.extend({init:function(t){s.Clip.apply(this,[t])},source:s.Clip,container_draw:function(t){this._life--?this._emitter_draw(t):this.remove()},life:10,on_emit:null,count:1,spawn:function(){var t=new this.source;return t._life=this.life,t._emitter_draw=t.draw,t.draw=this.container_draw,t},_emit:function(){var t=this.spawn();this.add_object(t),this.on_emit&&this.on_emit(t)},update:function(){for(var t=this.count;t--;)this._emit()}}),s.Map=s.DisplayObject.extend({sprites:null,map:null,tw:0,th:0,offsetX:0,offsetY:0,init:function(t){s.DisplayObject.apply(this,[t]),null===this.map&&(this.map=[])},to_iso:function(t,i){var e=this,n=(0|this.tw/2)+this.offsetX,s=(0|this.th/2)+this.offsetY,r=i%2?0:-n,h=(0|t*e.tw-r)-this.cx,a=(0|i*s)-this.cy;return{x:h,y:a}},paint:s.Paint.Map}),s.Action=s.Class.extend({_init:s.Class,update:null,draw:s.Draw.Void,init:function(t){"function"===s.get_type(t)&&(t={update:t}),this._init(t)},remove:s.DisplayObject.prototype.remove},{rotate:function(t){return function(){t.rotation=6.1>t.rotation?t.rotation+.1:0}}}),s.Engine=s.Class.extend({version:"0.9.0",__fps:31,_renderLoopFn:null,_gameLoopFn:null,_renderLoopId:0,_gameLoopId:0,run:function(){var i=this;return i.clear_process(),i._renderLoopFn=i._renderLoop.bind(i),i._renderLoop(),i._gameLoopFn=i._gameLoop.bind(i),i._gameLoopId=t.setInterval(i._gameLoopFn,i.__fps),i},clear_process:function(){t.clearInterval(this._gameLoopId),t.cancelAnimationFrame(this._renderLoopId)},destroy:function(){this.clear_process(),this._renderLoopFn=function(){},this.on_destroy&&this.on_destroy()},_renderLoop:function(){this.stage.draw(),this._renderLoopId=t.requestAnimationFrame(this._renderLoopFn)},_gameLoop:function(){this.stage.update()},startFn:function(){},init:function(t){var n=this;"function"==typeof t&&(t={startFn:t}),t===i&&(t={}),e=s.dom("CANVAS"),n.fps(t.fps||n.__fps),delete t.fps,s.Class.apply(n,[t]),n.stage_settings||(n.stage_settings={}),n.stage_settings.canvas||(n.stage_settings.canvas=s.id("screen")),n.stage||(n.stage=new s.Stage(n.stage_settings)),n.startFn(s,n)},pause:function(){this.process&&(t.clearInterval(this.process),t.cancelAnimationFrame(this.process)),this._rafScopedLoop=function(){}},resume:function(){this.stage&&this.stage.play()},fps:function(t){return t===i?1e3/this.__fps:(this.__fps=1e3/t,this)},imagedata:function(t,i){var n,r;switch(s.get_type(t)){case"string":n=s.id(t);break;case"dom":n=t;break;case"j5g3":n=t.source}return n?(e.width=n.width,e.height=n.height,r=e.getContext("2d"),r.drawImage(n,0,0),r.getImageData(0,0,n.width,n.height)):this.stage.context.createImageData(t||this.stage.canvas.width,i||this.stage.canvas.height)}}),s.Easing=function(){var t,i={},e={},n=function(t,i){e["EaseIn"+t]=i,e["EaseOut"+t]=function(t){return 1-i(1-t)},e["EaseInOut"+t]=function(t){return.5>t?i(2*t)/2:i(-2*t+2)/-2+1}};["Quad","Cubic","Quart","Quint","Expo"].forEach(function(t,e){i[t]=function(t){return Math.pow(t,e+2)}}),i.Sine=function(t){return 1-Math.cos(t*Math.PI/2)},i.Circ=function(t){return 1-Math.sqrt(1-t*t)},i.Elastic=function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},i.Back=function(t){return t*t*(3*t-2)},i.Bounce=function(t){for(var i,e,n=4;((i=Math.pow(2,--n))-1)/11>t;);return e=1/Math.pow(4,3-n)-7.5625*Math.pow((3*i-2)/22-t,2)};for(t in i)n(t,i[t]);return e.Linear=function(t){return t},e.Swing=function(t){return-Math.cos(t*Math.PI)/2+.5},e}(),s.action=r(s.Action),s.clip=r(s.Clip),s.image=r(s.Image),s.sprite=r(s.Sprite),s.spritesheet=r(s.Spritesheet),s.text=r(s.Text),s.stage=r(s.Stage),s.mtext=function(t){var i=new s.Text(t);return i.paint=s.Paint.MultilineText,i},s.matrix=function(t,i,e,n,r,h){return new s.Matrix(t,i,e,n,r,h)},s.tween=r(s.Tween),s.emitter=r(s.Emitter),s.map=r(s.Map),s.html=r(s.Html),s.engine=r(s.Engine),t.j5g3=s})(this),function(t,i){i.Loader=i.Class.extend({EVENT:{IMG:"load",AUDIO:"canplaythrough",SCRIPT:"load"},sources:null,delay:250,progress:0,start:null,length:0,on_progress:null,on_source:null,on_ready:null,init:function(t){i.Class.apply(this,[t]),this.sources={},this.start=new Date},_check_ready:function(){var i,e=0,n=0,s=this;for(i in this.sources)n++,this.sources.hasOwnProperty(i)&&this.sources[i].ready&&e++;this.progress=e?e/n:0,this.on_progress&&this.on_progress(this.progress),n===e?this.on_ready&&this.on_ready():this._timeout=t.setTimeout(function(){s._check_ready()},this.delay)},el:function(e,n){var s,r=this,h=this.sources[n];return h?h=h.el:(h=i.dom(e),this.sources[n]=s={el:h},h.addEventListener(this.EVENT[e],function(){s.ready=!0,r.on_source&&r.on_source(s)},!1),h.addEventListener("error",function(){s.ready=!0,t.console.warn("Could not load asset: "+n)},!1),h.setAttribute("src",n),this.length++),h},img:function(t){return this.el("IMG",t)},audio:function(t){var e=t.split(".").pop();return i.support.audio[e]||(t=t.replace(RegExp("\\."+e+"$"),"."+i.support.audio.preferred)),this.el("AUDIO",t)},data:function(i,e){var n=this,s=new t.XMLHttpRequest,r=this.sources[i];return r||(r=this.sources[i]={source:i},s.onreadystatechange=function(){4===s.readyState&&(r.ready=!0,r.raw=s.responseText,e&&e(r),n.on_source&&n.on_source(s))},s.open("GET",i),s.send()),r},json:function(t){return this.data(t,function(t){t.json=JSON.parse(t.raw)})},script:function(i){var e=this.el("SCRIPT",i);return t.document.head.appendChild(e),e},ready:function(t){t&&(this.on_ready=t),this._check_ready()},destroy:function(){t.clearTimeout(this._timeout)}}),i.loader=i.factory(i.Loader)}(this,this.j5g3),function(t){"use strict";t.Collision=t.Class.extend({A:null,B:null,nx:0,ny:0,penetration:0,length:0,tx:0,ty:0,0:null,1:null,2:null,3:null,4:null,5:null,6:null,init:function(t){t&&this.extend(t)}}),t.CollisionQuery={Circle:function(t){var i=this.radius+t.radius,e=this.x-t.x,n=this.y-t.y;return i*i>e*e+n*n?{nx:e,ny:n}:undefined},_AABB:function(t){var i,e,n=this.x+this.width,s=t.x+t.width,r=this.y+this.height,h=t.y+t.height,a=this.collision;return a.collides=!(t.x>=n||this.x>=s||t.y>=r||this.y>=h),a.collides?(a.B=t,i=a.tx=t.x+t.width/2-(this.x+this.width/2),e=a.ty=t.y+t.height/2-(this.y+this.height/2),a[0]=Math.max(this.x,t.x),a[1]=Math.max(this.y,t.y),a[2]=Math.min(n,s),a[3]=Math.min(r,h),a[2]-a[0]<a[3]-a[1]?(a.nx=0>i?-1:1,a.ny=0,a.penetration=0>i?a[2]-this.x:n-a[0]):(a.ny=0>e?-1:1,a.nx=0,a.penetration=0>e?a[3]-this.y:r-a[1]),this.collision):undefined},AABB:function(i){return this.collision=new t.Collision({length:2,A:this}),this.collides=t.CollisionQuery._AABB,this.collides(i)}},t.CollisionTest={AABB:function(t){var i=this.x+this.width,e=this.y+this.height,n=t.x+t.width,s=t.y+t.height;return!(t.x>i||this.x>n||t.y>e||this.y>s)},Container:function(t){for(var i=this.frame,e=i,n=!1,s={x:t.x-this.x,y:t.y-this.y,width:t.width,height:t.height};(e=e._previous)!==i&&!(n=e.collides&&e.collides(s)););return n}},t.DisplayObject.prototype.collides=t.CollisionTest.AABB,t.Clip.prototype.collides=t.CollisionTest.Container}(this.j5g3),function(t,i){"use strict";t.Shape=t.DisplayObject.extend({shape:null,red:i,green:i,blue:i,color_property:"fill",_red:i,_green:i,_blue:i,init:function(i){t.DisplayObject.apply(this,[i])},_begin:t.DisplayObject.prototype.begin,begin:function(t){var i=this;(i.red!==i._red||i.blue!==i._blue||i.green!==i._green)&&(i[i.color_property]="rgb("+Math.floor(i.red)+","+Math.floor(i.green)+","+Math.floor(i.blue)+")",i._red=i._red,i._green=i.green,i._blue=i.blue),this._begin(t)},paintPath:function(){},paint:function(t){t.beginPath(),this.paintPath(t),t.closePath(),t.fill(),t.stroke()}}),t.Circle=t.Shape.extend({shape:"circle",radius:0,init:function(i){t.Shape.apply(this,[i])},paintPath:function(t){t.arc(this.cx,this.cy,this.radius,0,2*Math.PI,!1)},at:t.HitTest.Circle}),t.Line=t.Shape.extend({x2:0,y2:0,paintPath:function(t){t.moveTo(this.cx,this.cy),t.lineTo(this.x2,this.y2)}}),t.Polygon=t.Shape.extend({shape:"polygon",points:null,normals:null,init:function(i){t.Shape.apply(this,[i]),null===this.points&&(this.points=[]),null===this.normals&&this.calculate_normals()},normalize:function(t){var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return t[0]=t[0]/i,t[1]=t[1]/i,t},calculate_normals:function(){for(var t,i=0,e=this.points,n=e.length,s=[],r=[0,0];n>i;i+=2)t=n>i+2?i+2:0,r[0]=e[t]-e[i],r[1]=e[t+1]-e[i+1],this.normalize(r),s.push(r[1],-r[0]);this.normals=s},paintPath:function(t){var i=2,e=this.points,n=e.length;for(t.moveTo(e[0],e[1]);n>i;i+=2)t.lineTo(e[i],e[i+1])},at:t.HitTest.Polygon},{create:function(i,e){var n=2*Math.PI/i,s=n;for(e.points=[];i--;)e.points.push(Math.cos(s)*e.radius,Math.sin(s)*e.radius),s+=n;return new t.Polygon(e)}}),t.Rect=t.Shape.extend({shape:"polygon",init:function(i){t.Shape.apply(this,[i]),null===this.width&&(this.height=this.width=2*this.radius)},paint:function(t){t.fillRect(this.cx,this.cy,this.width,this.height),t.strokeRect(this.cx,this.cy,this.width,this.height)}}),t.Dot=t.Shape.extend({shape:"circle",line_cap:"round",line_join:"round",color_property:"stroke",init:function(i){"number"==typeof i&&(i={line_width:i}),t.Shape.apply(this,[i])},paint:function(t){t.strokeRect(0,0,1,1)}}),t.polygon=t.factory(t.Polygon),t.circle=t.factory(t.Circle),t.line=t.factory(t.Line),t.dot=t.factory(t.Dot),t.rect=t.factory(t.Rect)}(this.j5g3),function(t,i){"use strict";var e=i.dom("audio");if(Function.prototype.bind||(Function.prototype.bind=function(t){var i=this;return function(){return i.apply(t,arguments)}}),t.HTMLAudioElement||(t.HTMLAudioElement=t.Audio),t.requestAnimationFrame||(t.requestAnimationFrame=t.mozRequestAnimationFrame||t.msRequestAnimationFrame||function(i){return t.setTimeout(i,1e3/60)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=t.mozCancelAnimationFrame||t.msCancelAnimationFrame||function(i){t.clearTimeout(i)}),i.support={audio:{}},e&&e.canPlayType){i.support.audio={mp3:e.canPlayType("audio/mpeg"),ogg:e.canPlayType("audio/ogg"),mp4:e.canPlayType("audio/mp4"),wav:e.canPlayType("audio/wav")};for(var n in i.support.audio)if(i.support.audio[n]){i.support.audio.preferred=n;break}}}(this,this.j5g3);